<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8" />
    <title>Compte-rendu - Application R√©partie Nancy</title>
    <link rel="stylesheet" href="css/compte-rendu.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üåê Application R√©partie Nancy</h1>
        <p class="subtitle">Syst√®me distribu√© de gestion de restaurants et donn√©es urbaines</p>
    </div>

    <div class="content">
        <section class="section">
            <h2>üèóÔ∏è Architecture</h2>
            <p>
                L'application repose sur une architecture r√©partie compos√©e de :
            </p>
            <ul>
                <li>Un serveur RMI (Java) qui interroge la base de donn√©es ou des API tierces</li>
                <li>Un proxy HTTP (Java) qui sert les donn√©es en JSON pour le client web</li>
                <li>Une interface client (HTML + Leaflet) qui affiche les donn√©es sur une carte</li>
            </ul>
        </section>

        <section class="section">
            <h2>üìä Donn√©es disponibles</h2>
            <ul>
                <li>üö≤ Stations V√©loStan'Lib (donn√©es temps r√©el)</li>
                <li>üöß Incidents et travaux (donn√©es Grand Nancy)</li>
                <li>üçΩÔ∏è Restaurants (donn√©es issues de la base MySQL)</li>
            </ul>
        </section>

        <section class="section">
            <h2>üß™ Tests des fonctionnalit√©s</h2>
            <p>
                <a class="map-link" href="./index.html">üó∫Ô∏è Acc√©der √† la carte interactive</a>
            </p>
            <p>Exemples d'API disponibles :</p>
            <ul>
                <li>Requ√™te REST : <code>GET /restaurants</code></li>
                <li>R√©servation de table via POST : <code>/reservation</code></li>
                <li>Liste des incidents en JSON : <code>/incidents</code></li>
            </ul>
        </section>

        <section class="section">
            <h2>‚öôÔ∏è D√©tails techniques</h2>
            <ul>
                <li>Port RMI : <code>1099</code></li>
                <li>Port HTTP Proxy : <code>8000</code></li>
                <li>Communication client ‚Üí proxy ‚Üí RMI ‚Üí BDD/API</li>
                <li>Technologies :
                    <span class="tech-badge">Java</span>
                    <span class="tech-badge">RMI</span>
                    <span class="tech-badge">MySQL</span>
                    <span class="tech-badge">HTML/JS</span>
                    <span class="tech-badge">Leaflet</span>
                </li>
            </ul>
        </section>

        <section class="section">
            <h2>üõ†Ô∏è Installation & Configuration</h2>
            <ul>
                <li><strong>Base de donn√©es :</strong> Installation de MySQL, cr√©ation de la base <code>resto_nancy</code> et des tables via <code>restaurants.sql</code> et <code>restaurants2.sql</code></li>
                <li><strong>Configuration :</strong> Fichier <code>.env</code> √† la racine du projet avec les variables <code>DB_URL</code>, <code>DB_USER</code>, <code>DB_PASSWORD</code></li>
                <li><strong>Compilation :</strong> Utilisation de Maven pour compiler et ex√©cuter le serveur (<code>mvn exec:java</code>), ou compilation manuelle possible</li>
                <li><strong>Lancement :</strong> D√©marrer <code>rmiregistry</code> dans <code>target/classes</code>, puis le serveur RMI, ensuite le proxy HTTP</li>
            </ul>
        </section>

        <section class="section">
            <h2>üîß Sch√©ma de l'architecture</h2>
            <div class="architecture-diagram">
                [Client Web HTML/JS]<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚Üì<br/>
                [Proxy HTTP Java (port 8000)]<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚Üì<br/>
                [Serveur RMI Java (port 1099)]<br/>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;‚Üì<br/>
                [Base MySQL / API externes]
            </div>
        </section>

        <section class="section">
            <h2>üîÑ Exemple de flux de donn√©es</h2>
            <ol>
                <li>L'utilisateur consulte la carte ou r√©serve une table sur l'interface web</li>
                <li>Le client envoie une requ√™te HTTP (GET/POST) au proxy</li>
                <li>Le proxy appelle le serveur RMI via Java RMI</li>
                <li>Le serveur RMI interroge la base MySQL ou une API externe</li>
                <li>La r√©ponse remonte jusqu'au client web, affich√©e en JSON ou sur la carte</li>
            </ol>
        </section>

        <section class="section">
            <h2>üíª Exemple de code Java : R√©servation via RMI</h2>
            <pre><code>// C√¥t√© ProxyServer.java
String json = rmiService.reserverTable(nom, prenom, nb, tel, id);

// C√¥t√© RestaurantServiceImpl.java
public String reserverTable(String nom, String prenom, int nb,
                           String telephone, int idResto) throws RemoteException {
    try (PreparedStatement stmt = connection.prepareStatement(
        "INSERT INTO reservations (nom, prenom, nb_personnes, telephone, id_restaurant) VALUES (?, ?, ?, ?, ?)"
    )) {
        stmt.setString(1, nom);
        stmt.setString(2, prenom);
        stmt.setInt(3, nb);
        stmt.setString(4, telephone);
        stmt.setInt(5, idResto);
        stmt.executeUpdate();

        return new JSONObject()
            .put("status", "ok")
            .put("message", "R√©servation enregistr√©e.")
            .toString();
    } catch (SQLException e) {
        return new JSONObject()
            .put("status", "error")
            .put("message", e.getMessage())
            .toString();
    }
}</code></pre>
        </section>

        <section class="section">
            <h2>üîê Configuration .env attendue</h2>
            <pre><code>DB_URL=jdbc:mysql://localhost:3306/resto_nancy
DB_USER=root
DB_PASSWORD=ton_mot_de_passe</code></pre>
        </section>

        <section class="section">
            <h2>‚úÖ Tests & v√©rification</h2>
            <ul>
                <li>Test de la connexion √† la base via IntelliJ ou <code>mysql</code> en ligne de commande</li>
                <li>Test du serveur RMI avec <code>ClientTest.java</code></li>
                <li>Test du proxy avec <code>curl http://localhost:8000/restaurants</code> ou Postman</li>
                <li>V√©rification de la r√©servation en base apr√®s un POST sur <code>/reservation</code></li>
            </ul>
        </section>

        <section class="section authors">
            <h2>üë• √âquipe de d√©veloppement</h2>
            <ul>
                <li>Nicolas SANJUAN</li>
                <li>Joey ROSENKRANZ</li>
                <li>Pac√¥me TERRIER</li>
            </ul>
        </section>
    </div>
</div>

<button class="back-to-top" onclick="scrollToTop()">‚Üë</button>

<script>
    // Bouton retour en haut
    window.onscroll = function() {
        const backToTopBtn = document.querySelector('.back-to-top');
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            backToTopBtn.classList.add('show');
        } else {
            backToTopBtn.classList.remove('show');
        }
    };

    function scrollToTop() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }
</script>

</body>
</html>
